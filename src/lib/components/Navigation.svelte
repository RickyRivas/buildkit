<script lang="ts">
  import "$styles/nav.less"
  import { pages } from "$lib/config"
  import { page } from "$app/stores"
  import { enhance } from "$app/forms"
  import type { SubmitFunction } from "@sveltejs/kit"
  import { onMount } from "svelte"

  let isActive = false

  function toggleNav() {
    isActive = !isActive
  }

  // Dark mode
  let currentTheme: any

  export const updateTheme: SubmitFunction = ({ action }) => {
    if (currentTheme === "light") {
      currentTheme = "dark"
    } else if (currentTheme === "dark") {
      currentTheme = "light"
    }

    const theme = action.searchParams.get("theme")
    if (theme) {
      document.documentElement.setAttribute("data-theme", theme)
    }
  }

  onMount(() => {
    currentTheme = document.documentElement.getAttribute("data-theme")

    if (!currentTheme) {
      currentTheme = "light"
    }
  })

  // add class to header when user scrolls 100px
  let y: any
</script>

<svelte:window bind:scrollY={y} />

<nav class:active={isActive} class={y >= 100 ? "scroll" : ""}>
  <div class="container">
    <!-- Logo -->
    <a href="/" class="logo">
      <svg
        width="148"
        height="178"
        viewBox="0 0 148 178"
        fill="none"
        xmlns="http://www.w3.org/2000/svg">
        <title>Svelte Logo</title>
        <path
          d="M138.234 23.4733C121.76 -0.104537 89.2235 -7.09314 65.6996 7.89466L24.3936 34.2271C18.8106 37.7373 14.0216 42.3741 10.3329 47.8409C6.64416 53.3077 4.13695 59.4841 2.97158 65.9752C1.00129 76.9074 2.73374 88.1844 7.89465 98.0211C4.35771 103.386 1.94525 109.412 0.803081 115.735C-0.373506 122.356 -0.216258 129.146 1.2656 135.705C2.74746 142.265 5.52411 148.462 9.43271 153.935C25.9063 177.516 58.4448 184.506 81.9657 169.513L123.281 143.181C128.863 139.67 133.65 135.033 137.337 129.566C141.024 124.099 143.53 117.923 144.694 111.433C146.667 100.502 144.939 89.2242 139.783 79.3853C143.318 74.0206 145.729 67.9953 146.87 61.673C148.048 55.052 147.892 48.2624 146.41 41.7027C144.928 35.1429 142.151 28.9452 138.242 23.4733"
          fill="#FF3E00" />
        <path
          d="M61.6635 156.154C55.1618 157.844 48.298 157.498 41.999 155.163C35.7001 152.828 30.2693 148.617 26.4401 143.097C24.09 139.807 22.4204 136.08 21.5294 132.136C20.6383 128.192 20.5436 124.11 21.2509 120.129C21.4903 118.822 21.8201 117.533 22.2378 116.272L23.0155 113.896L25.1333 115.45C30.0198 119.043 35.4839 121.775 41.2901 123.528L42.825 123.994L42.684 125.527C42.4976 127.706 43.0885 129.88 44.352 131.665C45.505 133.329 47.1411 134.599 49.0391 135.303C50.9372 136.007 53.0056 136.111 54.9648 135.601C55.8611 135.363 56.7158 134.989 57.4992 134.493L98.8131 108.157C99.8242 107.521 100.692 106.681 101.36 105.69C102.028 104.7 102.483 103.581 102.695 102.406C102.907 101.205 102.878 99.9751 102.609 98.7863C102.341 97.5976 101.838 96.4743 101.13 95.4819C99.9773 93.8181 98.3413 92.5482 96.4434 91.8437C94.5455 91.1392 92.4772 91.0341 90.5177 91.5425C89.6214 91.781 88.7667 92.1549 87.9833 92.6513L72.2177 102.702C69.6232 104.35 66.7922 105.593 63.8225 106.386C57.3208 108.076 50.4569 107.731 44.1579 105.396C37.8589 103.061 32.4282 98.8491 28.5991 93.3293C26.2483 90.0393 24.5782 86.313 23.6869 82.3689C22.7955 78.4248 22.7008 74.3424 23.4083 70.3613C24.1104 66.4581 25.6194 62.7444 27.8388 59.4577C30.0582 56.171 32.9392 53.3837 36.2974 51.2741L77.616 24.9432C80.2099 23.2926 83.041 22.0485 86.0112 21.2541C92.5129 19.5641 99.3767 19.9099 105.676 22.2448C111.975 24.5798 117.405 28.7914 121.235 34.311C123.585 37.6012 125.255 41.3276 126.146 45.2716C127.038 49.2156 127.132 53.2978 126.425 57.279C126.184 58.5857 125.854 59.8743 125.437 61.1361L124.659 63.5121L122.543 61.9613C117.657 58.368 112.193 55.6359 106.386 53.8829L104.85 53.4172L104.992 51.8839C105.178 49.7039 104.588 47.5283 103.326 45.7412C102.173 44.0774 100.537 42.8077 98.6386 42.1038C96.7406 41.3998 94.6723 41.2955 92.7131 41.8049C91.8167 42.0433 90.9621 42.4172 90.1787 42.9137L48.8537 69.2509C47.8428 69.8868 46.9757 70.7267 46.3077 71.7167C45.6398 72.7068 45.1857 73.8253 44.9745 75.0008C44.7616 76.201 44.79 77.4316 45.0582 78.6207C45.3263 79.8098 45.8289 80.9334 46.5363 81.9261C47.6897 83.5897 49.3257 84.8595 51.2235 85.5639C53.1213 86.2684 55.1896 86.3736 57.1491 85.8655C58.0453 85.6265 58.8998 85.2527 59.6835 84.7567L75.4475 74.7109C78.0409 73.0597 80.8722 71.816 83.8427 71.0234C90.3442 69.3332 97.2078 69.679 103.507 72.014C109.805 74.3489 115.236 78.5607 119.065 84.0803C121.415 87.3703 123.085 91.0966 123.977 95.0407C124.868 98.9848 124.963 103.067 124.255 107.048C123.555 110.951 122.047 114.666 119.83 117.953C117.613 121.241 114.734 124.03 111.377 126.142L70.0587 152.465C67.465 154.116 64.6338 155.36 61.6635 156.154Z"
          fill="white" />
      </svg>
    </a>

    <!-- Nav links -->
    <ul class="nav-links" class:active={isActive}>
      {#each pages as { name, path }}
        <li class="nav-link">
          <a class:active={$page.url.pathname === path} href={path} on:click={toggleNav}>{name}</a>
        </li>
      {/each}
      <li class="">
        <a href="/contact" class="btn" on:click={toggleNav}>Learn More</a>
      </li>
    </ul>

    <!-- Toggle -->
    <button class="toggle" aria-label="Toggle" class:active={isActive} on:click={toggleNav}>
      <span />
      <span />
      <span />
    </button>
    <form id="theme" method="POST" use:enhance={updateTheme}>
      <button
        id="themeToggle"
        class={currentTheme}
        formaction="/?/setTheme&theme={currentTheme === 'light'
          ? 'dark'
          : 'light'}&redirectTo={$page.url.pathname}"
        aria-label="Dark mode"
        aria-pressed={currentTheme === "light" ? false : true}>
        <span>
          <svg
            width="33"
            height="33"
            viewBox="0 0 33 33"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            {#if currentTheme === "light"}
              <path
                d="M16.6512 31.6917C22.7143 31.7555 28.2526 28.2618 30.8065 22.7627C29.1993 23.464 27.4585 23.8074 25.7053 23.7693C18.833 23.7616 13.2637 18.1923 13.2559 11.3199C13.3247 6.6713 15.8897 2.41917 19.9694 0.189635C18.8692 0.0495461 17.7603 -0.0131761 16.6512 0.0022972C7.90024 0.0022972 0.806549 7.09626 0.806549 15.847C0.806549 24.598 7.90024 31.6917 16.6512 31.6917Z"
                fill="currentcolor" />
            {:else if currentTheme === "dark"}
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M18.101 4.88068C17.8012 5.18066 17.3947 5.34948 16.9706 5.35012C16.5466 5.34947 16.1401 5.18064 15.8403 4.88066C15.5406 4.58068 15.3721 4.17406 15.3718 3.74999V1.61655C15.3718 1.19247 15.5403 0.78577 15.8401 0.485905C16.14 0.18604 16.5467 0.0175781 16.9708 0.0175781C17.3948 0.0175781 17.8015 0.18604 18.1014 0.485905C18.4013 0.78577 18.5697 1.19247 18.5697 1.61655V3.74999C18.5694 4.17408 18.4008 4.58071 18.101 4.88068ZM16.9706 6.95053C15.1771 6.95019 13.4238 7.48171 11.9324 8.47788C10.4411 9.47404 9.27857 10.8901 8.59199 12.547C7.90542 14.2038 7.7256 16.0271 8.07527 17.7861C8.42495 19.5452 9.28842 21.1611 10.5565 22.4294C11.8245 23.6977 13.4402 24.5615 15.1992 24.9115C16.9582 25.2616 18.7815 25.0821 20.4385 24.3959C22.0955 23.7096 23.5118 22.5474 24.5083 21.0562C25.5047 19.565 26.0366 17.8118 26.0366 16.0183C26.0341 13.6145 25.0782 11.3098 23.3786 9.60981C21.679 7.90986 19.3745 6.95349 16.9706 6.95053ZM31.3842 14.4182H29.2528C28.8284 14.4182 28.4214 14.5868 28.1213 14.8869C27.8212 15.187 27.6526 15.594 27.6526 16.0184C27.6526 16.4427 27.8212 16.8497 28.1213 17.1498C28.4214 17.4499 28.8284 17.6185 29.2528 17.6185H31.3842C31.8086 17.6185 32.2156 17.4499 32.5156 17.1498C32.8157 16.8497 32.9843 16.4427 32.9843 16.0184C32.9843 15.594 32.8157 15.187 32.5156 14.8869C32.2156 14.5868 31.8086 14.4182 31.3842 14.4182ZM15.8402 27.1497C16.14 26.8498 16.5465 26.681 16.9706 26.6803C17.3947 26.681 17.8012 26.8498 18.1009 27.1498C18.4007 27.4498 18.5692 27.8564 18.5695 28.2804V30.4139C18.5695 30.8379 18.401 31.2447 18.1011 31.5445C17.8013 31.8444 17.3946 32.0128 16.9705 32.0128C16.5464 32.0128 16.1397 31.8444 15.8399 31.5445C15.54 31.2447 15.3715 30.8379 15.3715 30.4139V28.2804C15.3719 27.8563 15.5405 27.4497 15.8402 27.1497ZM6.31465 16.0183C6.31428 15.5943 6.14572 15.1876 5.84594 14.8876C5.54616 14.5877 5.13964 14.4188 4.71555 14.4182H2.58446C2.16008 14.4182 1.75307 14.5868 1.45299 14.8869C1.1529 15.187 0.984314 15.594 0.984314 16.0184C0.984314 16.4427 1.1529 16.8497 1.45299 17.1498C1.75307 17.4499 2.16008 17.6185 2.58446 17.6185H4.71555C5.13964 17.6179 5.54617 17.449 5.84595 17.1491C6.14573 16.8491 6.31429 16.4424 6.31465 16.0183ZM26.7764 8.47401L28.285 6.96546C28.4339 6.81709 28.5522 6.6408 28.6329 6.44668C28.7136 6.25256 28.7553 6.04442 28.7555 5.83417C28.7557 5.62393 28.7145 5.41571 28.6341 5.22143C28.5538 5.02715 28.4359 4.85062 28.2872 4.70196C28.1385 4.55329 27.962 4.4354 27.7677 4.35504C27.5735 4.27468 27.3652 4.23342 27.155 4.23362C26.9448 4.23383 26.7366 4.2755 26.5425 4.35624C26.3484 4.43698 26.1721 4.55521 26.0237 4.70417L24.5151 6.21275C24.3662 6.36113 24.2479 6.53742 24.1672 6.73154C24.0864 6.92566 24.0448 7.1338 24.0446 7.34405C24.0444 7.55429 24.0856 7.76251 24.166 7.95679C24.2464 8.15107 24.3642 8.32759 24.5129 8.47626C24.6616 8.62492 24.8381 8.74281 25.0324 8.82316C25.2267 8.90353 25.4349 8.94478 25.6451 8.94457C25.8554 8.94436 26.0635 8.90269 26.2576 8.82195C26.4518 8.7412 26.628 8.62297 26.7764 8.47401ZM26.2574 23.215C26.4515 23.2957 26.6278 23.4139 26.7762 23.5628L28.2848 25.0714C28.4337 25.2198 28.5519 25.3961 28.6326 25.5902C28.7133 25.7843 28.7549 25.9924 28.7551 26.2026C28.7553 26.4128 28.714 26.621 28.6337 26.8153C28.5533 27.0095 28.4354 27.186 28.2868 27.3347C28.1381 27.4833 27.9616 27.6012 27.7674 27.6815C27.5731 27.7619 27.3649 27.8032 27.1547 27.803C26.9445 27.8028 26.7364 27.7612 26.5423 27.6805C26.3482 27.5998 26.1719 27.4816 26.0235 27.3327L24.5149 25.8241C24.366 25.6757 24.2478 25.4995 24.1671 25.3053C24.0864 25.1112 24.0448 24.9031 24.0446 24.6929C24.0444 24.4827 24.0857 24.2745 24.1661 24.0802C24.2464 23.886 24.3643 23.7095 24.5129 23.5609C24.6616 23.4122 24.8381 23.2943 25.0323 23.214C25.2266 23.1336 25.4348 23.0923 25.645 23.0925C25.8552 23.0927 26.0633 23.1343 26.2574 23.215ZM7.16485 23.5626L5.6563 25.0712C5.50729 25.2196 5.38902 25.3959 5.30823 25.59C5.22745 25.7841 5.18575 25.9923 5.18552 26.2026C5.1853 26.4128 5.22654 26.6211 5.30691 26.8154C5.38727 27.0097 5.50516 27.1863 5.65385 27.3349C5.80253 27.4836 5.97908 27.6015 6.17339 27.6819C6.36769 27.7622 6.57594 27.8035 6.78621 27.8033C6.99648 27.803 7.20464 27.7613 7.39877 27.6805C7.5929 27.5998 7.7692 27.4815 7.91756 27.3325L9.42614 25.8239C9.57504 25.6755 9.69323 25.4993 9.77393 25.3051C9.85463 25.111 9.89627 24.9029 9.89645 24.6927C9.89664 24.4825 9.85537 24.2743 9.775 24.08C9.69464 23.8858 9.57677 23.7093 9.42812 23.5607C9.27948 23.412 9.10298 23.2941 8.90873 23.2138C8.71448 23.1334 8.50629 23.0921 8.29607 23.0923C8.08586 23.0925 7.87774 23.1341 7.68363 23.2148C7.48952 23.2956 7.31323 23.4137 7.16485 23.5626ZM7.68381 8.82103C7.48976 8.74051 7.31348 8.62254 7.16504 8.47385L5.65648 6.96527C5.50732 6.81694 5.38889 6.64064 5.30798 6.44647C5.22708 6.25229 5.18528 6.04406 5.18498 5.83371C5.18469 5.62335 5.2259 5.415 5.30627 5.2206C5.38663 5.0262 5.50456 4.84957 5.65331 4.70083C5.80205 4.55208 5.97868 4.43415 6.17308 4.35378C6.36748 4.27342 6.57583 4.2322 6.78618 4.23249C6.99654 4.23279 7.20477 4.27458 7.39894 4.35549C7.59312 4.43639 7.76942 4.55482 7.91775 4.70398L9.42633 6.21256C9.57502 6.36099 9.69299 6.53727 9.77352 6.73132C9.85404 6.92537 9.89553 7.13339 9.89562 7.34348C9.89571 7.55358 9.85439 7.76163 9.77404 7.95575C9.69368 8.14987 9.57585 8.32625 9.42729 8.47481C9.27873 8.62337 9.10236 8.74119 8.90824 8.82155C8.71412 8.90191 8.50606 8.94323 8.29597 8.94314C8.08588 8.94305 7.87786 8.90156 7.68381 8.82103Z"
                fill="currentcolor" />
            {/if}
          </svg>
        </span>
      </button>
    </form>
  </div>
</nav>
